@page "/huffman_coding_output"

@using States
@using Problem.HuffmanCoding;
@inherits ProblemOutputBase<HuffmanCodingOutput>

<ReturnButton ButtonPosition="HangingButton.HangingButtonPosition.Right"/>
@if (_outputData != null)
{
    <h2>Zakodowana melodia:</h2>
    <p>@_outputData.Result</p>
    <h2>Melodia przed zakodowaniem:</h2>
    <p>@_outputData.InputPhrase</p>
    <h2>Kody Huffmana:</h2>
    @foreach (var hufCode in _codes)
    {
        <p>@hufCode</p>
    }
}

@code {
    HuffmanCodingOutput? _outputData;
    List<string> _codes = new();


    protected override async Task OnInitializedAsync()
    {
        if (ProblemState != null) 
            _outputData = await ProblemState.GetProblemOutputData<HuffmanCodingOutput>();
        else
            throw new NullReferenceException("ProblemState is null");
        _codes = ExtractCodes();
    }

    private List<string> ExtractCodes()
    {
        List<string> list = [];
        if (_outputData is null)
            throw new NullReferenceException("_outputData can't be null");
        
        foreach (var key in _outputData.HuffmanDictionary.Keys)
        {
            var code = "";
            if (key != ' ')
            {
                code += key + " -> " + _outputData.HuffmanDictionary[key];
            }
            else {
                code += "_ -> " + _outputData.HuffmanDictionary[key];
            }
            list.Add(code);
        }
        return list;
    }
}