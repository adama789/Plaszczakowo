@using GraphDrawer
@inject IJSRuntime JsRuntime;
@rendermode InteractiveServer

<div class="canvas_wrapper">
    <BECanvas Width="CanvasWidth ?? 1280" Height="CanvasHeight ?? 720" @ref="_canvasReference" />
</div>

<style>
    div.canvas_wrapper {
        position: absolute;
        z-index: 1;

        width: 100vw;
        height: 100vh;
        
        overflow: hidden;
    }
</style>

@code {

    [Parameter]
    public required GraphInput Input { get; set; }

    [Parameter] 
    public int? CanvasWidth { get; set; }

    [Parameter] 
    public int? CanvasHeight { get; set; }

    private BECanvasComponent? _canvasReference;

    private Canvas2DContext? _context;
    
    private GraphDrawer? _drawer;

    private double _zoom = 1.0;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await EnableCanvasZoom();
        
        _context = await _canvasReference.CreateCanvas2DAsync();
        _drawer = new GraphDrawer(_context, Input);
        
        await _drawer.Draw();
    }

    private async Task EnableCanvasZoom()
    {
        await JsRuntime.InvokeAsync<Task>("enableCanvasZoom", null);
    }
}