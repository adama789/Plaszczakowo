@using GraphDrawer
@inject IJSRuntime JsRuntime;
@rendermode InteractiveServer

<div class="canvas_wrapper">
    <BECanvas Width="CanvasWidth ?? 1280" Height="CanvasHeight ?? 720" @ref="_canvasReference" />
</div>

<style>
    div.canvas_wrapper {
        position: absolute;
        z-index: 1;

        width: 100vw;
        height: 100vh;
        
        overflow: hidden;
    }
</style>

@code {

    [Parameter]
    public required GraphData Data { get; set; }

    [Parameter] 
    public int? CanvasWidth { get; set; }

    [Parameter] 
    public int? CanvasHeight { get; set; }

    [Parameter] 
    public bool EnableZoom { get; set; } = true;

    private BECanvasComponent? _canvasReference;

    private Canvas2DContext? _context;
    
    private GraphDrawer? _drawer;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (EnableZoom)
                await EnableCanvasZoom();
        
            _context = await _canvasReference.CreateCanvas2DAsync();
            _drawer = new GraphDrawer(_context, Data);
        
            await _drawer.Draw();
        }
    }

    private async Task EnableCanvasZoom()
    {
        await JsRuntime.InvokeAsync<Task>("enableCanvasZoom", null);
    }

    public async Task Redraw()
    {
        if (_drawer is null) 
            return;

        await _drawer.Draw();
    }
}